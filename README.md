# personal-capture-sample-application
This is a guide on how to implement a custom protocol for launching Kaltura Capture from your own application. *It is not a standalone app*

## Getting started

Don't forget to fill in the blanks in `config.php`. Your Partner ID, Admin Secret (can both be found in Integration Settings in the KMC), and the relevant User ID, as well as the current version of Kaltura Capture and any name to describe the user role for KalturaCapture. 

## Download links for the latest version of Kaltura Capture

Before launch is available, the application must be installed. The download URLS for both Windows and OSX can be found in the global Kaltura UiConf object. Right at the beginning of the php script, after configuring and setting a new Kaltura Session on a Client object, you'll find this line `list($windows, $osx) = getDownloadLinks($client);` 

**getDownloadLinks()** looks for a uiConf object with the name "KalturaCaptureVersioning" and then decodes the returned json. Both download links, which are found in the config object of the uiConf, are returned from the function. 

You'll find those links being used in the html at the bottom of the code. You can also do a check to see if the user already has the application installed (read more [here](https://stackoverflow.com/questions/2872090/how-to-check-if-a-custom-protocol-supported)). 

## Creating a launch url

Essentially the launch url looks like this: 

```kaltura-pc:<Base 64 encoding of a json object containing external settings>```

The json object containing external settings looks like this:
```
    {
        "appToken": "xxxxxx",
        "appTokenId": "1_xxxxx",
        "userId": "xxxx.xxxxxx@kaltura.com",
        "partnerId": "xxxxxx",
        "serviceUrl": "http://www.kaltura.com",
        "appHost": "xxxxxxx.kaltura.com",
        "entryURL": "media",
        "hostingAppType": "MediaSpace",
        "hashType": "SHA256"
    }
```

As you can see, you'll need a special App Token, which is used to enable applications to acquire a valid Kaltura Session (KS). What you need to do is create a permanent Application Token in order to generate a temporary Kaltura Session. A valid Kaltura Session is needed for each call to Kaltura's API, in order to identify the application, content access permissions, and API access permissions (as well as other session data). All this information is securely encrypted and hashed, preventing unauthorized manipulation of the session context.    
So how do you get that app token?

You'll first retrieve all available Application Tokens for the given user, and search through them to find the first one of type KalturaCaptureToken and the current version of Personal Capture. 
If the token doesn't exist, create a new one: 
A token creation requires a specific Personal Capture roles, which you search for, or create a new one if it does not exist. The role is created with a pre configured name, various permissions needed for the application launch, and the tag "kalturacapture."
Once you have the relevant role, its ID is used to create a new ApplicationToken, with other settings such as the hashType(SHA-256 in this case), token type, and current version.  

When you finally have the app token, you're ready to create the json settings object. It needs the `token` and the `id` of the application token object. Some other fields are: 
- **appHost** is the hosting application url that is being used when generating the uploaded entry URL. For example, when using KMS, the host url will be `www.<partnerId>.kaltura.com`
- **entryURL** is the relative path to the media entry in our Media hosting application. For example, when using KMS, when set to 'media' the entry url generated by the application will navigate to the media entry itself, like `www.<partnerId>.mediaspace.com/media/<entryId>`
- **hostingAppType** is currently being used to determine the hosting site url for displaying it in our application info page. If 'kaf' type was chosen, the app will concat 'appHost' and 'entryUrl' properties to assemble the site url; otherwise the app will use only the 'appHost' property.

Encode the object with a Base64 encoder, and you end up with a string that looks something like this:

`ICAgIHsNCiAgICAgICAgImFwcFRva2VuIjogInh4eHh4eCIsDQogICAgICAgICJhcHBUb2tlbklkIjogIjFfeHh4eHgiLA0KICAgICAgICAidXNlcklkIjogInh4eHgueHh4eHh4QGthbHR1cmEuY29tIiwNCiAgICAgICAgInBhcnRuZXJJZCI6ICJ4eHh4eHgiLA0KICAgICAgICAic2VydmljZVVybCI6ICJodHRwOi8vd3d3LmthbHR1cmEuY29tIiwNCiAgICAgICAgImFwcEhvc3QiOiAieHh4eHh4eC5rYWx0dXJhLmNvbSIsDQogICAgICAgICJlbnRyeVVSTCI6ICJtZWRpYSIsDQogICAgICAgICJob3N0aW5nQXBwVHlwZSI6ICJNZWRpYVNwYWNlIiwNCiAgICAgICAgImhhc2hUeXBlIjogIlNIQTI1NiINCiAgICB9`

Add the prefix `kaltura-pc:`, as can be seen in the HTML portion of the code. Run that url from the browser, and assuming that Personal Capture is installed, the app should now launch! 


# How you can help (guidelines for contributors) 
Thank you for helping Kaltura grow! If you'd like to contribute please follow these steps:
* Use the repository issues tracker to report bugs or feature requests
* Read [Contributing Code to the Kaltura Platform](https://github.com/kaltura/platform-install-packages/blob/master/doc/Contributing-to-the-Kaltura-Platform.md)
* Sign the [Kaltura Contributor License Agreement](https://agentcontribs.kaltura.org/)

## Where to get help
* Join the [Kaltura Community Forums](https://forum.kaltura.org/) to ask questions or start discussions
* Read the [Code of conduct](https://forum.kaltura.org/faq) and be patient and respectful

## Get in touch
We'd love to hear from you!
You can learn more about Kaltura and start a free trial at: http://corp.kaltura.com    
Contact us via Twitter [@Kaltura](https://twitter.com/Kaltura) or email: community@kaltura.com  

## License and Copyright Information
All code in this project is released under the [AGPLv3 license](http://www.gnu.org/licenses/agpl-3.0.html) unless a different license for a particular library is specified in the applicable library path.   

Copyright Â© Kaltura Inc. All rights reserved.   
Authors and contributors: See [GitHub contributors list](https://github.com/kaltura/recruitment-application/graphs/contributors).  
